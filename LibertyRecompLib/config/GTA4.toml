# LibertyRecomp - GTA IV Xbox 360 Recompilation Config
# This is the main configuration file for XenonRecomp

[main]
file_path = "../../Grand Theft Auto IV (USA) (En,Fr,De,Es,It)/default.xex"
out_directory_path = "../ppc"
switch_table_file_path = "./gta4_switch_tables.toml"

# Optimizations - disabled until we have a working build
skip_lr = false
skip_msr = false
ctr_as_local = false
xer_as_local = false
reserved_as_local = false
cr_as_local = false
non_argument_as_local = false
non_volatile_as_local = false

# Debug/scaling options
verbose = true                       # Print progress messages
progress_every = 1000                # Print progress every N functions
skip_auto_discovery = false          # Set to true to skip .pdata and branch scanning
cpp_chunk_functions = 256            # Functions per .cpp chunk (lower = less RAM, more files)
disable_identical_file_check = true  # Skip file comparison to save RAM
use_lightweight_analysis = true      # Use memory-efficient analysis (HIGHLY RECOMMENDED)
max_functions_in_memory = 1000       # Max functions to hold during recompilation

# Register save/restore function addresses
# Found using FindPatterns tool on GTA IV XEX
restgprlr_14_address = 0x8298EB30
savegprlr_14_address = 0x8298EAE0
restfpr_14_address = 0x8299015C
savefpr_14_address = 0x82990110
restvmx_14_address = 0x82990598
savevmx_14_address = 0x82990300
restvmx_64_address = 0x8299062C
savevmx_64_address = 0x82990394

# setjmp/longjmp addresses (if used by the game)
# longjmp_address = 0x00000000
# setjmp_address = 0x00000000

# Explicit function boundaries for functions with jump tables
# that XenonAnalyse couldn't detect correctly
# Also includes functions that branch into other functions (tail call optimization)
#
# These are typically CRT string/memory functions with optimized loops
# that share common loop bodies across multiple entry points
functions = [
    # strncmp-like function that branches into its own continuation
    # sub_82990020 branches to loc_82990048 which is in sub_82990048
    { address = 0x82990020, size = 0x50 }, # Covers 0x82990020 to 0x82990070
    
    # Memcpy-like functions with shared loop bodies
    # These functions (sub_8299094C through sub_82990CB8) have interrelated branches
    # Covering the entire range: 0x8299094C to 0x82990CC8
    { address = 0x8299094C, size = 0x37C }, # Covers 0x8299094C to 0x82990CC8
]

# Invalid instruction patterns to skip
invalid_instructions = [
    { data = 0x00000000, size = 4 }, # Padding
]

# Mid-asm hooks for intercepting game functions
# Example:
# [[midasm_hook]]
# name = "MyHookFunction"
# address = 0x82XXXXXX
# registers = ["r3", "r4"]
